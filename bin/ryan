#!/usr/bin/env reia

puts('Starting up Ryan...')
ryan_dir = [code::lib_dir().to_string(), 'ryan'].join('/')

required = ['retem.re', 'ryan.re', 'session.re', 'controller.re']
required.each do |lib|
  'Loading #{lib}...'.print()
  load('#{ryan_dir}/#{lib}')
  ' done.'.puts()
end

# Initializing application
load('startup.re')
Startup.initialize()

ets::new(:sessions, [:named_table, :public])
ets::new(:templates, [:named_table, :public])

port = 8001
port = System.args()[1].to_int() if System.args()[0] == "-p"

yaws = true
yaws = false if System.args()[2] == "--mochi"

if yaws
  yaws_shim::init_yaws(port)
else
  mochi_shim::start_mochi(port)
end